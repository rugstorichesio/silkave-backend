<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Silk Ave Companion</title>
  <style>
    body {
      background-color: #111;
      color: #0f0;
      font-family: monospace;
      padding: 2rem;
    }
    h1, h2, h3 {
      text-align: center;
    }
    input, select, button {
      margin: 0.3rem;
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 0.3rem;
      font-family: monospace;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #0f0;
      padding: 0.5rem;
      text-align: center;
    }
    .log, .inventory-status {
      white-space: pre-line;
      background: #000;
      border: 1px solid #0f0;
      padding: 1rem;
      margin-top: 2rem;
    }
    .bottom-bar {
      text-align: center;
      margin-top: 2rem;
      font-weight: bold;
      font-size: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #0f0;
    }
  </style>
</head>
<body>
  <h1>Silk Ave Game Companion</h1>
  <div>
    <h2>Cycle: <span id="cycle">1</span> / 10</h2>
    <h3>BTC: <span id="btc">100</span> | Glock: <span id="glock">No</span> | Inventory: <span id="invCount">0</span>/20</h3>
  </div>

  <div class="actions">
    <h3>Setup This Cycle</h3>
    <label>Event Card Code: <input type="text" id="eventCode"></label>
    <button onclick="applyEvent()">Apply Event</button>
    <br>
    <button onclick="rollDice()">ðŸŽ² Roll Dice</button>
    <span id="diceResult"></span>
    <br>
    <label>Burner Deal Item:
      <select id="burnerDeal">
        <option value="">--Select--</option>
        <option value="lsd">LSD</option>
        <option value="weed">Weed</option>
        <option value="cocaine">Cocaine</option>
        <option value="mdma">MDMA</option>
        <option value="passports">Fake Passports</option>
        <option value="accounts">Hacked Accounts</option>
        <option value="ccs">Credit Cards</option>
        <option value="files">Stolen Files</option>
      </select>
    </label>
    <button onclick="applyBurnerDeal()">Apply Burner Deal</button>
  </div>

  <div class="market">
    <h3>Market Prices</h3>
    <table id="marketTable">
      <thead>
        <tr><th>Item</th><th>Price</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="inventory">
    <h3>Buy/Sell</h3>
    <table id="transactionTable">
      <thead>
        <tr>
          <th>Item</th><th>Buy</th><th>Sell</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="executeTransactions()">Execute Transactions</button>
    <button onclick="buyGlock()">Buy Glock (20 BTC)</button>
  </div>

  <div class="log" id="log"></div>
  <div class="inventory-status" id="inventoryStatus"></div>

  <div style="text-align: center; margin-top: 2rem;">
    <button onclick="advanceCycle()">Advance to Next Cycle</button>
  </div>
  
  <div class="bottom-bar">
    Cycle: <span id="cycleBottom">1</span> / 10 |
    BTC: <span id="btcBottom">100</span> |
    Glock: <span id="glockBottom">No</span> |
    Inventory: <span id="invCountBottom">0</span>/20
  </div>

  <script>
const items = ["lsd", "weed", "cocaine", "mdma", "passports", "accounts", "ccs", "files"];
const itemNames = {
  lsd: "LSD",
  weed: "Weed",
  cocaine: "Cocaine",
  mdma: "MDMA",
  passports: "Fake Passports",
  accounts: "Hacked Accounts",
  ccs: "Credit Cards",
  files: "Stolen Files"
};
const priceMatrix = {
  lsd: [1, 1, 2, 3, 4, 5],
  weed: [1, 2, 3, 3, 4, 5],
  cocaine: [4, 5, 6, 7, 8, 9],
  mdma: [3, 4, 5, 6, 7, 8],
  passports: [2, 3, 4, 5, 6, 7],
  accounts: [3, 4, 5, 6, 7, 8],
  ccs: [2, 3, 5, 6, 7, 9],
  files: [4, 5, 6, 7, 8, 10]
};

let inventory = {};
let btc = 100;
let glock = false;
let cycle = 1;
let currentPrices = {};
let burnerItem = "";

function rollDice() {
  const roll = Math.floor(Math.random() * 6) + 1;
  document.getElementById("diceResult").textContent = `ðŸŽ² Rolled: ${roll}`;
  updateMarketPrices(roll);
}

function updateMarketPrices(roll) {
  currentPrices = {};
  let tbody = document.querySelector("#marketTable tbody");
  tbody.innerHTML = "";
  items.forEach(item => {
    let price = priceMatrix[item][roll - 1];
    currentPrices[item] = price;
    tbody.innerHTML += `<tr><td>${itemNames[item]}</td><td>${price} BTC</td></tr>`;
  });
  populateTransactionTable();
}

function applyBurnerDeal() {
  let item = document.getElementById("burnerDeal").value;
  if (item && currentPrices[item]) {
    currentPrices[item] = priceMatrix[item][0];
    updateMarketPricesDisplay();
    log(`-- Burner Deal Applied: ${itemNames[item]} set to ${currentPrices[item]} BTC`);
  }
}

function updateMarketPricesDisplay() {
  let tbody = document.querySelector("#marketTable tbody");
  tbody.innerHTML = "";
  items.forEach(item => {
    tbody.innerHTML += `<tr><td>${itemNames[item]}</td><td>${currentPrices[item]} BTC</td></tr>`;
  });
}

function populateTransactionTable() {
  let tbody = document.querySelector("#transactionTable tbody");
  tbody.innerHTML = "";
  items.forEach(item => {
    tbody.innerHTML += `
      <tr>
        <td>${itemNames[item]}</td>
        <td><input type="number" id="buy-${item}" min="0"></td>
        <td><input type="number" id="sell-${item}" min="0"></td>
      </tr>
    `;
  });
}

function executeTransactions() {
  let output = "";
  let totalInventory = Object.values(inventory).reduce((acc, val) => acc + val.length, 0);

  items.forEach(item => {
    const buyQty = parseInt(document.getElementById(`buy-${item}`).value) || 0;
    const sellQty = parseInt(document.getElementById(`sell-${item}`).value) || 0;

    if (buyQty > 0) {
      let cost = currentPrices[item] * buyQty;
      if (btc >= cost && totalInventory + buyQty <= 20) {
        btc -= cost;
        inventory[item] = inventory[item] || [];
        for (let i = 0; i < buyQty; i++) {
          inventory[item].push(currentPrices[item]);
        }
        output += `>>> Bought ${buyQty} ${itemNames[item]} for ${cost} BTC (${currentPrices[item]} BTC each)\n`;
        totalInventory += buyQty;
      } else {
        output += `â›” Cannot buy ${buyQty} ${itemNames[item]} (Insufficient BTC or space)\n`;
      }
    }

    if (sellQty > 0) {
      if (inventory[item]?.length >= sellQty) {
        let gain = currentPrices[item] * sellQty;
        btc += gain;
        inventory[item].splice(0, sellQty);
        output += `>>> Sold ${sellQty} ${itemNames[item]} for ${gain} BTC\n`;
        totalInventory -= sellQty;
      } else {
        output += `â›” Cannot sell ${sellQty} ${itemNames[item]} (Not enough in inventory)\n`;
      }
    }
  });

  log(output.trim());
  updateStatusBars();
  updateInventoryDisplay();
  populateTransactionTable();
}

function updateInventoryDisplay() {
  let totalInventory = 0;
  let output = "-- Inventory:\n";
  items.forEach(item => {
    if (inventory[item]?.length > 0) {
      totalInventory += inventory[item].length;
      const units = inventory[item];
      const unique = [...new Set(units)];
      if (unique.length === 1) {
        output += `- ${itemNames[item]}: ${units.length} @ ${unique[0]} BTC each\n`;
      } else {
        output += `- ${itemNames[item]}: ${units.length} (${units.join(", ")} BTC)\n`;
      }
    }
  });
  if (totalInventory === 0) output += "- Empty\n";
  document.getElementById("inventoryStatus").textContent = output.trim();
}

function buyGlock() {
  if (!glock && btc >= 20) {
    btc -= 20;
    glock = true;
    log(">>> Glock acquired (20 BTC deducted)");
    updateStatusBars();
  } else {
    log("â›” Cannot buy Glock (already owned or not enough BTC)");
  }
}

function advanceCycle() {
  if (cycle < 10) {
    cycle++;
    log(`=== Starting Cycle ${cycle} ===`);
    updateStatusBars();
  } else {
    log("=== GAME OVER: Final Round ===");
    finalizeScore();
  }
}

function finalizeScore() {
  let output = "";
  items.forEach(item => {
    if (inventory[item]?.length > 0) {
      let qty = inventory[item].length;
      let payout = qty * currentPrices[item];
      btc += payout;
      output += `>>> Auto-sold ${qty} ${itemNames[item]} @ ${currentPrices[item]} = ${payout} BTC\n`;
      inventory[item] = [];
    }
  });
  output += `\n=== FINAL BTC: ${btc} ===\n>>> Glock: ${glock ? "Yes" : "No"}`;
  log(output.trim());
  updateStatusBars();
  updateInventoryDisplay();
}

function updateStatusBars() {
  document.getElementById("btc").textContent = btc;
  document.getElementById("btcBottom").textContent = btc;
  document.getElementById("glock").textContent = glock ? "Yes" : "No";
  document.getElementById("glockBottom").textContent = glock ? "Yes" : "No";
  let totalInventory = Object.values(inventory).reduce((acc, val) => acc + val.length, 0);
  document.getElementById("invCount").textContent = totalInventory;
  document.getElementById("invCountBottom").textContent = totalInventory;
  document.getElementById("cycle").textContent = cycle;
  document.getElementById("cycleBottom").textContent = cycle;
}

function log(text) {
  document.getElementById("log").textContent += text + "\n";
}

function applyEvent() {
  let code = document.getElementById("eventCode").value.trim();
  if (code !== "") {
    log(`-- Event code ${code} applied.`);
  }
}
</script>
</body>
</html>
